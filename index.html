<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Glaze Journal</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'DM Sans', sans-serif; 
      background: #F8F8F8;
      min-height: 100vh;
    }
    .font-serif { font-family: 'DM Serif Text', serif; }
    .font-mono { font-family: 'DM Mono', monospace; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 40px; }
    .header { padding-top: 40px; display: flex; justify-content: space-between; align-items: flex-start; }
    .title { font-size: 40px; line-height: 55px; color: #1E654B; }
    .tagline { font-size: 16px; color: #1E1E1E; margin-top: 4px; }
    .btn { 
      background: #1E654B; 
      color: #FFFFFF; 
      border: none; 
      border-radius: 100px; 
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn:hover { opacity: 0.9; }
    .tabs { 
      margin-top: 146px; 
      padding-top: 24px; 
      border-bottom: 1px solid #D9D9D9;
      display: flex;
      gap: 0;
    }
    .tab {
      padding: 8px 24px;
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      position: relative;
      color: #757575;
      font-weight: 300;
    }
    .tab.active {
      color: #1E1E1E;
      font-weight: 500;
      border-bottom: 3px solid #1E654B;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-top: 24px;
      padding-bottom: 200px;
    }
    .card {
      background: white;
      border: 1px solid #D9D9D9;
      border-radius: 8px;
      padding: 8px;
      cursor: pointer;
      position: relative;
    }
    .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .card-image {
      width: 100%;
      aspect-ratio: 1;
      background: #E3E3E3;
      border-radius: 4px;
      margin-bottom: 16px;
      overflow: hidden;
    }
    .card-image img { width: 100%; height: 100%; object-fit: cover; }
    .badge {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .badge.good { background: #14AE5C; }
    .badge.bad { background: #EC221F; }
    .card-clay { font-size: 16px; color: #1E1E1E; }
    .card-glaze { font-size: 13px; color: #757575; margin-top: 4px; cursor: help; position: relative; }
    .card-glaze:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 0;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      white-space: nowrap;
      z-index: 1000;
      font-size: 13px;
      margin-bottom: 4px;
    }
    .modal { 
      display: none;
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,0.2); 
      z-index: 40; 
    }
    .modal.show { display: block; }
    .sidebar {
      position: fixed;
      right: -600px;
      top: 0;
      width: 600px;
      height: 100%;
      background: white;
      box-shadow: -2px 0 8px rgba(0,0,0,0.1);
      z-index: 50;
      overflow-y: auto;
      transition: right 0.3s;
    }
    .sidebar.show { right: 0; }
    .sidebar-content { padding: 32px; }
    .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .sidebar-title { font-size: 20px; color: #0D382C; }
    .close-btn { background: none; border: none; cursor: pointer; font-size: 24px; }
    .form-row { display: flex; gap: 24px; margin-bottom: 24px; }
    .form-group { flex: 1; }
    .form-group.fixed { width: 256px; flex-shrink: 0; }
    label { display: block; font-size: 16px; color: #1E1E1E; margin-bottom: 8px; }
    input, textarea, select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #D9D9D9;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
    }
    textarea { resize: none; height: 96px; }
    .image-upload {
      width: 256px;
      height: 256px;
      border: 2px dashed #757575;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: white;
    }
    .image-upload:hover { background: #f9f9f9; }
    .image-preview {
      width: 256px;
      height: 320px;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      cursor: pointer;
    }
    .image-preview img { width: 100%; height: 100%; object-fit: cover; }
    .remove-image {
      position: absolute;
      top: 8px;
      right: 8px;
      background: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .glaze-card {
      background: #F5F5F5;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
    }
    .layer-card {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .layer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .radio-group { display: flex; gap: 16px; margin-top: 16px; }
    .radio-label { display: flex; align-items: center; gap: 8px; cursor: pointer; }
    .footer-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 24px;
      border-top: 1px solid #D9D9D9;
    }
    .btn-group { display: flex; gap: 8px; }
    .btn-secondary {
      background: white;
      color: #1E1E1E;
      border: 1px solid #757575;
      border-radius: 100px;
      padding: 8px 24px;
      cursor: pointer;
    }
    .btn-delete {
      background: none;
      border: none;
      color: #C00F0C;
      text-decoration: underline;
      cursor: pointer;
      font-size: 14px;
    }
    .hidden { display: none; }
    .divider { border-bottom: 1px solid #D9D9D9; margin: 24px 0; }
    .inline-fields { display: flex; gap: 16px; align-items: center; }
    .coats-input { width: 80px; }
    .footer-link {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    .footer-link a {
      color: #1E1E1E;
      text-decoration: underline;
      font-size: 14px;
      font-weight: 300;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 class="title font-serif">Glaze journal</h1>
        <p class="tagline font-mono">Documenting glaze combo and tests</p>
      </div>
      <button class="btn font-mono" onclick="openSidebar()">
        <span>‚ûï</span> New entry
      </button>
    </div>

    <div class="tabs font-mono">
      <button class="tab active" onclick="filterTab('All')">All</button>
      <button class="tab" onclick="filterTab('Good')">Good</button>
      <button class="tab" onclick="filterTab('Bad')">Bad</button>
    </div>

    <div class="grid" id="grid"></div>
  </div>

  <div class="footer-link">
    <div style="width:100px;height:78px;background:#ddd;border-radius:4px;"></div>
    <a href="https://instagram.com/jshi.ceramics" target="_blank" class="font-mono">
      instagram.com/jshi.ceramics
    </a>
  </div>

  <div class="modal" id="modal" onclick="closeSidebar()"></div>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-content">
      <div class="sidebar-header">
        <h2 class="sidebar-title font-mono" id="sidebar-title">New entry</h2>
        <button class="close-btn" onclick="closeSidebar()">‚úï</button>
      </div>
      <div class="divider"></div>

      <form onsubmit="handleSave(event)">
        <div class="form-row">
          <div class="form-group fixed">
            <label>Image</label>
            <input type="file" id="imageInput" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
            <div id="uploadArea" class="image-upload" onclick="document.getElementById('imageInput').click()">
              <span style="font-size:20px">üì§</span>
              <span style="font-size:14px;color:#757575;margin-top:8px;">Click to upload</span>
            </div>
            <div id="previewArea" class="image-preview hidden" onclick="viewFullImage()">
              <img id="preview" src="" alt="">
              <button type="button" class="remove-image" onclick="removeImage(event)">‚úï</button>
            </div>
          </div>

          <div style="flex:1;">
            <div class="form-group">
              <label>Clay</label>
              <input type="text" id="clay" list="clay-list" placeholder="Select or type...">
              <datalist id="clay-list"></datalist>
            </div>
            <div class="form-group">
              <label>Firing temperature (¬∞C)</label>
              <input type="number" id="temperature" placeholder="¬∞C">
            </div>
            <div class="form-group">
              <label>Cone</label>
              <input type="number" id="cone" placeholder="Number">
            </div>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="atmosphere" value="Oxidation" checked> Oxidation
              </label>
              <label class="radio-label">
                <input type="radio" name="atmosphere" value="Reduction"> Reduction
              </label>
            </div>
          </div>
        </div>

        <div class="glaze-card">
          <h3 class="font-mono" style="margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid #D9D9D9;">Glaze details</h3>
          <div id="layers"></div>
          <button type="button" onclick="addLayer()" style="background:none;border:none;color:#757575;text-decoration:underline;cursor:pointer;font-size:14px;">
            ‚ûï Add new layer
          </button>
        </div>

        <div class="form-group">
          <label>Result</label>
          <div class="radio-group" style="margin-top:8px;">
            <label class="radio-label">
              <input type="radio" name="result" value="Good" checked> Good
            </label>
            <label class="radio-label">
              <input type="radio" name="result" value="Bad"> Bad
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>Notes</label>
          <textarea id="notes" placeholder="Add any notes..."></textarea>
        </div>

        <div class="footer-actions">
          <button type="button" id="deleteBtn" class="btn-delete hidden" onclick="deletePiece()">
            üóëÔ∏è Delete
          </button>
          <div class="btn-group">
            <button type="button" class="btn-secondary font-mono" onclick="closeSidebar()">Cancel</button>
            <button type="submit" class="btn font-mono">Save entry</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    let pieces = [];
    let currentTab = 'All';
    let editingId = null;
    let currentImage = null;
    let clayOptions = ['Porcelain', 'Stoneware', 'Earthenware'];
    let brandOptions = ['Amaco', 'Mayco', 'Spectrum'];
    let glazeOptions = ['Celadon', 'Tenmoku', 'Shino'];

    function loadData() {
      const data = localStorage.getItem('ceramics-pieces');
      if (data) pieces = JSON.parse(data);
      
      const clay = localStorage.getItem('clay-options');
      if (clay) clayOptions = JSON.parse(clay);
      
      const brand = localStorage.getItem('brand-options');
      if (brand) brandOptions = JSON.parse(brand);
      
      const glaze = localStorage.getItem('glaze-options');
      if (glaze) glazeOptions = JSON.parse(glaze);
      
      updateDataLists();
      renderGrid();
    }

    function saveData() {
      localStorage.setItem('ceramics-pieces', JSON.stringify(pieces));
      localStorage.setItem('clay-options', JSON.stringify(clayOptions));
      localStorage.setItem('brand-options', JSON.stringify(brandOptions));
      localStorage.setItem('glaze-options', JSON.stringify(glazeOptions));
    }

    function updateDataLists() {
      document.getElementById('clay-list').innerHTML = clayOptions.map(o => `<option value="${o}">`).join('');
    }

    function addToOptions(value, array) {
      if (value && !array.includes(value)) array.push(value);
    }

    function renderGrid() {
      const filtered = pieces.filter(p => {
        if (currentTab === 'All') return true;
        return p.result === currentTab;
      });

      const grid = document.getElementById('grid');
      grid.innerHTML = filtered.map(p => {
        const glazeText = p.layers.length > 1 
          ? (p.layers[0].glaze || 'Untitled') + ` +${p.layers.length - 1}`
          : (p.layers[0]?.glaze || 'Untitled');
        
        const tooltip = p.layers.length > 1 
          ? p.layers.map(l => l.glaze).filter(Boolean).join(', ')
          : '';

        return `
          <div class="card font-mono" onclick="editPiece(${p.id})">
            <div class="card-image">
              ${p.image ? `<img src="${p.image}" alt="">` : ''}
            </div>
            <div class="badge ${p.result === 'Good' ? 'good' : 'bad'}">
              ${p.result === 'Good' ? '‚úì' : '‚úï'}
            </div>
            <div class="card-clay">${p.clay || 'No clay specified'}</div>
            <div class="card-glaze" ${tooltip ? `data-tooltip="${tooltip}"` : ''}>${glazeText}</div>
          </div>
        `;
      }).join('');
    }

    function filterTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      renderGrid();
    }

    function openSidebar() {
      editingId = null;
      currentImage = null;
      document.getElementById('sidebar-title').textContent = 'New entry';
      document.getElementById('deleteBtn').classList.add('hidden');
      document.querySelector('form').reset();
      document.getElementById('uploadArea').classList.remove('hidden');
      document.getElementById('previewArea').classList.add('hidden');
      renderLayers([{ brand: '', glaze: '', application: 'Dipped', coats: '' }]);
      document.getElementById('modal').classList.add('show');
      document.getElementById('sidebar').classList.add('show');
    }

    function editPiece(id) {
      const piece = pieces.find(p => p.id === id);
      if (!piece) return;
      
      editingId = id;
      currentImage = piece.image;
      document.getElementById('sidebar-title').textContent = 'Edit entry';
      document.getElementById('deleteBtn').classList.remove('hidden');
      
      document.getElementById('clay').value = piece.clay;
      document.getElementById('temperature').value = piece.temperature;
      document.getElementById('cone').value = piece.cone;
      document.getElementById('notes').value = piece.notes || '';
      document.querySelector(`input[name="atmosphere"][value="${piece.atmosphere}"]`).checked = true;
      document.querySelector(`input[name="result"][value="${piece.result}"]`).checked = true;
      
      if (piece.image) {
        document.getElementById('preview').src = piece.image;
        document.getElementById('uploadArea').classList.add('hidden');
        document.getElementById('previewArea').classList.remove('hidden');
      }
      
      renderLayers(piece.layers);
      document.getElementById('modal').classList.add('show');
      document.getElementById('sidebar').classList.add('show');
    }

    function closeSidebar() {
      document.getElementById('modal').classList.remove('show');
      document.getElementById('sidebar').classList.remove('show');
    }

    function renderLayers(layers = []) {
      const container = document.getElementById('layers');
      container.innerHTML = layers.map((layer, i) => `
        <div class="layer-card">
          <div class="layer-header">
            <span style="font-weight:500;font-size:14px;">${i === 0 ? 'Base layer' : `Layer ${i + 1}`}</span>
            ${i > 0 ? `<button type="button" onclick="removeLayer(${i})" style="color:#C00F0C;background:none;border:none;cursor:pointer;text-decoration:underline;font-size:14px;">Remove</button>` : ''}
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
            <div>
              <label>Brand</label>
              <input type="text" class="layer-brand" value="${layer.brand}" list="brand-list-${i}">
              <datalist id="brand-list-${i}">${brandOptions.map(o => `<option value="${o}">`).join('')}</datalist>
            </div>
            <div>
              <label>Glaze name</label>
              <input type="text" class="layer-glaze" value="${layer.glaze}" list="glaze-list-${i}">
              <datalist id="glaze-list-${i}">${glazeOptions.map(o => `<option value="${o}">`).join('')}</datalist>
            </div>
          </div>
          <div class="inline-fields">
            <div>
              <label>Coats:</label>
              <input type="number" class="layer-coats coats-input" value="${layer.coats || ''}" min="0">
            </div>
            <div class="radio-group" style="margin-top:0;">
              <label class="radio-label">
                <input type="radio" name="app${i}" value="Dipped" ${layer.application === 'Dipped' ? 'checked' : ''}> Dipped
              </label>
              <label class="radio-label">
                <input type="radio" name="app${i}" value="Brushed" ${layer.application === 'Brushed' ? 'checked' : ''}> Brushed
              </label>
            </div>
          </div>
        </div>
      `).join('');
    }

    function addLayer() {
      const brands = Array.from(document.querySelectorAll('.layer-brand')).map(i => i.value);
      const glazes = Array.from(document.querySelectorAll('.layer-glaze')).map(i => i.value);
      const coats = Array.from(document.querySelectorAll('.layer-coats')).map(i => i.value);
      const apps = Array.from(document.querySelectorAll('[name^="app"]')).filter(i => i.checked).map(i => i.value);
      
      const layers = brands.map((b, i) => ({
        brand: b,
        glaze: glazes[i],
        application: apps[i],
        coats: coats[i]
      }));
      
      layers.push({ brand: '', glaze: '', application: 'Dipped', coats: '' });
      renderLayers(layers);
    }

    function removeLayer(index) {
      const brands = Array.from(document.querySelectorAll('.layer-brand')).map(i => i.value);
      const glazes = Array.from(document.querySelectorAll('.layer-glaze')).map(i => i.value);
      const coats = Array.from(document.querySelectorAll('.layer-coats')).map(i => i.value);
      const apps = Array.from(document.querySelectorAll('[name^="app"]')).filter(i => i.checked).map(i => i.value);
      
      const layers = brands.map((b, i) => ({
        brand: b,
        glaze: glazes[i],
        application: apps[i],
        coats: coats[i]
      })).filter((_, i) => i !== index);
      
      renderLayers(layers);
    }

    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        currentImage = e.target.result;
        document.getElementById('preview').src = currentImage;
        document.getElementById('uploadArea').classList.add('hidden');
        document.getElementById('previewArea').classList.remove('hidden');
      };
      reader.readAsDataURL(file);
    }

    function removeImage(e) {
      e.stopPropagation();
      currentImage = null;
      document.getElementById('imageInput').value = '';
      document.getElementById('uploadArea').classList.remove('hidden');
      document.getElementById('previewArea').classList.add('hidden');
    }

    function viewFullImage() {
      if (!currentImage) return;
      const win = window.open();
      win.document.write(`<img src="${currentImage}" style="max-width:100%;max-height:100vh;">`);
    }

    function handleSave(e) {
      e.preventDefault();
      
      const brands = Array.from(document.querySelectorAll('.layer-brand')).map(i => i.value);
      const glazes = Array.from(document.querySelectorAll('.layer-glaze')).map(i => i.value);
      const coats = Array.from(document.querySelectorAll('.layer-coats')).map(i => i.value);
      const apps = Array.from(document.querySelectorAll('[name^="app"]')).filter(i => i.checked).map(i => i.value);
      
      const layers = brands.map((b, i) => ({
        brand: b,
        glaze: glazes[i],
        application: apps[i],
        coats: coats[i]
      }));

      const piece = {
        id: editingId || Date.now(),
        image: currentImage,
        clay: document.getElementById('clay').value,
        temperature: document.getElementById('temperature').value,
        cone: document.getElementById('cone').value,
        atmosphere: document.querySelector('input[name="atmosphere"]:checked').value,
        layers: layers,
        result: document.querySelector('input[name="result"]:checked').value,
        notes: document.getElementById('notes').value
      };

      // Add to options
      addToOptions(piece.clay, clayOptions);
      layers.forEach(l => {
        addToOptions(l.brand, brandOptions);
        addToOptions(l.glaze, glazeOptions);
      });

      if (editingId) {
        const index = pieces.findIndex(p => p.id === editingId);
        pieces[index] = piece;
      } else {
        pieces.push(piece);
      }

      saveData();
      updateDataLists();
      renderGrid();
      closeSidebar();
    }

    function deletePiece() {
      if (!confirm('Are you sure you want to delete this piece?')) return;
      pieces = pieces.filter(p => p.id !== editingId);
      saveData();
      renderGrid();
      closeSidebar();
    }

    loadData();
  </script>
</body>
</html>
