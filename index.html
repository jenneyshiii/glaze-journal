<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Glaze Journal</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { X, Plus, Trash2, Instagram, Upload } = lucide;

    function CeramicsInventory() {
      const [pieces, setPieces] = useState([]);
      const [activeTab, setActiveTab] = useState('All');
      const [sidebarOpen, setSidebarOpen] = useState(false);
      const [editingPiece, setEditingPiece] = useState(null);
      const [imagePreview, setImagePreview] = useState(null);
      const [fullImageView, setFullImageView] = useState(false);
      
      const [clayOptions, setClayOptions] = useState(['Porcelain', 'Stoneware', 'Earthenware']);
      const [brandOptions, setBrandOptions] = useState(['Amaco', 'Mayco', 'Spectrum']);
      const [glazeOptions, setGlazeOptions] = useState(['Celadon', 'Tenmoku', 'Shino']);

      const [formData, setFormData] = useState({
        image: null,
        clay: '',
        temperature: '',
        cone: '',
        atmosphere: 'Oxidation',
        layers: [{ brand: '', glaze: '', application: 'Dipped', coats: '' }],
        result: 'Good',
        notes: ''
      });

      useEffect(() => {
        loadData();
      }, []);

      const loadData = async () => {
        try {
          const piecesData = await window.storage.get('ceramics-pieces', true);
          const clayData = await window.storage.get('clay-options', true);
          const brandData = await window.storage.get('brand-options', true);
          const glazeData = await window.storage.get('glaze-options', true);
          
          if (piecesData) setPieces(JSON.parse(piecesData.value));
          if (clayData) setClayOptions(JSON.parse(clayData.value));
          if (brandData) setBrandOptions(JSON.parse(brandData.value));
          if (glazeData) setGlazeOptions(JSON.parse(glazeData.value));
        } catch (error) {
          console.log('No existing data found');
        }
      };

      const saveData = async (newPieces, clay, brand, glaze) => {
        try {
          await window.storage.set('ceramics-pieces', JSON.stringify(newPieces), true);
          if (clay) await window.storage.set('clay-options', JSON.stringify(clay), true);
          if (brand) await window.storage.set('brand-options', JSON.stringify(brand), true);
          if (glaze) await window.storage.set('glaze-options', JSON.stringify(glaze), true);
        } catch (error) {
          console.error('Error saving data:', error);
        }
      };

      const openSidebar = (piece = null) => {
        if (piece) {
          setEditingPiece(piece);
          setFormData(piece);
          setImagePreview(piece.image);
        } else {
          setEditingPiece(null);
          setFormData({
            image: null,
            clay: '',
            temperature: '',
            cone: '',
            atmosphere: 'Oxidation',
            layers: [{ brand: '', glaze: '', application: 'Dipped', coats: '' }],
            result: 'Good',
            notes: ''
          });
          setImagePreview(null);
        }
        setSidebarOpen(true);
      };

      const closeSidebar = () => {
        setSidebarOpen(false);
        setEditingPiece(null);
        setImagePreview(null);
      };

      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            setImagePreview(reader.result);
            setFormData({ ...formData, image: reader.result });
          };
          reader.readAsDataURL(file);
        }
      };

      const addToOptions = (value, options, setOptions) => {
        if (value && !options.includes(value)) {
          const newOptions = [...options, value];
          setOptions(newOptions);
          return newOptions;
        }
        return options;
      };

      const handleSave = () => {
        let updatedClay = clayOptions;
        let updatedBrand = brandOptions;
        let updatedGlaze = glazeOptions;

        updatedClay = addToOptions(formData.clay, clayOptions, setClayOptions);
        formData.layers.forEach(layer => {
          updatedBrand = addToOptions(layer.brand, updatedBrand, setBrandOptions);
          updatedGlaze = addToOptions(layer.glaze, updatedGlaze, setGlazeOptions);
        });

        let newPieces;
        if (editingPiece) {
          newPieces = pieces.map(p => p.id === editingPiece.id ? { ...formData, id: p.id } : p);
        } else {
          newPieces = [...pieces, { ...formData, id: Date.now() }];
        }
        
        setPieces(newPieces);
        saveData(newPieces, updatedClay, updatedBrand, updatedGlaze);
        closeSidebar();
      };

      const handleDelete = () => {
        if (editingPiece && window.confirm('Are you sure you want to delete this piece?')) {
          const newPieces = pieces.filter(p => p.id !== editingPiece.id);
          setPieces(newPieces);
          saveData(newPieces);
          closeSidebar();
        }
      };

      const addLayer = () => {
        setFormData({
          ...formData,
          layers: [...formData.layers, { brand: '', glaze: '', application: 'Dipped', coats: '' }]
        });
      };

      const removeLayer = (index) => {
        setFormData({
          ...formData,
          layers: formData.layers.filter((_, i) => i !== index)
        });
      };

      const updateLayer = (index, field, value) => {
        const newLayers = [...formData.layers];
        newLayers[index][field] = value;
        setFormData({ ...formData, layers: newLayers });
      };

      const filteredPieces = pieces.filter(piece => {
        if (activeTab === 'All') return true;
        if (activeTab === 'Good') return piece.result === 'Good';
        if (activeTab === 'Bad') return piece.result === 'Bad';
        return true;
      });

      return (
        <div className="min-h-screen bg-[#F8F8F8] font-sans">
          <style>{`
            @import url('https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap');
            body { font-family: 'DM Sans', sans-serif; }
            .font-serif { font-family: 'DM Serif Text', serif; }
            .font-mono { font-family: 'DM Mono', monospace; }
            .instant-tooltip { position: relative; }
            .instant-tooltip:hover::after {
              content: attr(data-tooltip);
              position: absolute;
              bottom: 100%;
              left: 0;
              background-color: rgba(0, 0, 0, 0.9);
              color: white;
              padding: 8px 12px;
              border-radius: 4px;
              white-space: nowrap;
              z-index: 1000;
              font-size: 13px;
              margin-bottom: 4px;
              animation: none;
              transition: none;
            }
          `}</style>

          <div className="max-w-[1200px] mx-auto px-10 pt-10">
            <div className="flex justify-between items-start">
              <div>
                <h1 className="font-serif leading-[55px]" style={{ fontSize: '40px', color: '#1E654B' }}>
                  Glaze journal
                </h1>
                <p className="font-mono text-base text-[#1E1E1E] mt-1">
                  Documenting glaze combo and tests
                </p>
              </div>
              <button
                onClick={() => openSidebar()}
                className="font-mono font-medium text-base px-6 py-3 hover:opacity-90 transition-opacity"
                style={{ backgroundColor: '#1E654B', color: '#FFFFFF', borderRadius: '100px' }}
              >
                <Plus size={20} style={{ display: 'inline', marginRight: '8px' }} />
                New entry
              </button>
            </div>
          </div>

          <div className="max-w-[1200px] mx-auto px-10 mt-[146px] pt-6 relative">
            <div className="flex gap-0 border-b border-[#D9D9D9]">
              {['All', 'Good', 'Bad'].map(tab => (
                <button
                  key={tab}
                  onClick={() => setActiveTab(tab)}
                  className={`px-6 py-2 font-mono text-base relative transition-colors ${
                    activeTab === tab
                      ? 'text-[#1E1E1E] font-medium'
                      : 'text-[#757575] font-light hover:text-[#1E1E1E]'
                  }`}
                  style={activeTab === tab ? { borderBottom: '3px solid #1E654B' } : {}}
                >
                  {tab}
                </button>
              ))}
            </div>
          </div>

          <div className="max-w-[1200px] mx-auto px-10 mt-6">
            <div className="grid grid-cols-4 gap-4">
              {filteredPieces.map(piece => (
                <div
                  key={piece.id}
                  onClick={() => openSidebar(piece)}
                  className="bg-white border border-[#D9D9D9] rounded-lg p-2 cursor-pointer hover:shadow-lg transition-shadow relative"
                >
                  <div className="w-full aspect-square bg-[#E3E3E3] rounded mb-4 overflow-hidden">
                    {piece.image && (
                      <img src={piece.image} alt="" className="w-full h-full object-cover" />
                    )}
                  </div>
                  <div className="absolute top-4 right-4">
                    <div 
                      className="w-6 h-6 rounded-full flex items-center justify-center"
                      style={{ backgroundColor: piece.result === 'Good' ? '#14AE5C' : '#EC221F' }}
                    >
                      {piece.result === 'Good' ? (
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                          <path d="M7.5 11.5L4.5 8.5L3.5 9.5L7.5 13.5L14.5 6.5L13.5 5.5L7.5 11.5Z" fill="white"/>
                        </svg>
                      ) : (
                        <X size={14} color="white" strokeWidth={3} />
                      )}
                    </div>
                  </div>
                  <div className="font-mono" style={{ fontSize: '16px', color: '#1E1E1E' }}>
                    {piece.clay || 'No clay specified'}
                  </div>
                  <div 
                    className={`font-mono mt-1 ${piece.layers.length > 1 ? 'instant-tooltip cursor-help' : ''}`}
                    style={{ fontSize: '13px', color: '#757575' }}
                    data-tooltip={piece.layers.length > 1 ? piece.layers.map(layer => layer.glaze).filter(Boolean).join(', ') : ''}
                  >
                    {piece.layers.length > 1 
                      ? (piece.layers[0].glaze || 'Untitled') + ` +${piece.layers.length - 1}`
                      : piece.layers.map((layer, i) => layer.glaze).filter(Boolean).join(', ') || 'Untitled'}
                  </div>
                </div>
              ))}
            </div>
          </div>

          <div className="fixed bottom-10 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-4">
            <div className="w-[100px] h-[78px] bg-gray-200 rounded"></div>
            <a
              href="https://instagram.com/jshi.ceramics"
              target="_blank"
              rel="noopener noreferrer"
              className="font-mono text-sm font-light text-[#1E1E1E] underline flex items-center gap-2"
            >
              <Instagram size={16} />
              instagram.com/jshi.ceramics
            </a>
          </div>

          {sidebarOpen && (
            <>
              <div
                className="fixed inset-0 bg-black bg-opacity-20 z-40"
                onClick={closeSidebar}
              />
              <div className="fixed right-0 top-0 h-full w-[600px] bg-white shadow-lg z-50 overflow-y-auto">
                <div className="p-8">
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="font-mono text-xl text-[#0D382C]">
                      {editingPiece ? 'Edit entry' : 'New entry'}
                    </h2>
                    <button onClick={closeSidebar}>
                      <X size={24} className="text-[#1D1B20]" />
                    </button>
                  </div>

                  <div className="border-b border-[#D9D9D9] mb-6" />

                  <div className="flex gap-6 mb-6">
                    <div className="w-64 flex-shrink-0">
                      <label className="block text-base text-[#1E1E1E] mb-2">Image</label>
                      {!imagePreview ? (
                        <label className="block w-64 h-64 border-2 border-dashed border-[#757575] rounded-lg flex flex-col items-center justify-center cursor-pointer hover:bg-gray-50">
                          <input
                            type="file"
                            accept="image/*"
                            onChange={handleImageUpload}
                            className="hidden"
                          />
                          <Upload size={20} className="text-[#1E1E1E] mb-2" />
                          <span className="text-sm text-[#757575]">Click to upload</span>
                        </label>
                      ) : (
                        <div 
                          className="relative cursor-pointer w-64 h-80 overflow-hidden rounded-lg"
                          onClick={() => setFullImageView(true)}
                        >
                          <img
                            src={imagePreview}
                            alt="Preview"
                            className="w-full h-full object-cover"
                          />
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              setImagePreview(null);
                              setFormData({ ...formData, image: null });
                            }}
                            className="absolute top-2 right-2 bg-white rounded-full p-1 shadow"
                          >
                            <X size={16} />
                          </button>
                        </div>
                      )}
                    </div>

                    <div className="flex-1 space-y-4">
                      <div>
                        <label className="block text-base text-[#1E1E1E] mb-2">Clay</label>
                        <input
                          list="clay-options"
                          value={formData.clay}
                          onChange={(e) => setFormData({ ...formData, clay: e.target.value })}
                          className="w-full px-4 py-3 border border-[#D9D9D9] rounded-lg text-base"
                          placeholder="Select or type..."
                        />
                        <datalist id="clay-options">
                          {clayOptions.map(opt => <option key={opt} value={opt} />)}
                        </datalist>
                      </div>

                      <div>
                        <label className="block text-base text-[#1E1E1E] mb-2">Firing temperature (°C)</label>
                        <input
                          type="number"
                          value={formData.temperature}
                          onChange={(e) => setFormData({ ...formData, temperature: e.target.value })}
                          className="w-full px-4 py-3 border border-[#D9D9D9] rounded-lg text-base"
                          placeholder="°C"
                        />
                      </div>

                      <div>
                        <label className="block text-base text-[#1E1E1E] mb-2">Cone</label>
                        <input
                          type="number"
                          value={formData.cone}
                          onChange={(e) => setFormData({ ...formData, cone: e.target.value })}
                          className="w-full px-4 py-3 border border-[#D9D9D9] rounded-lg text-base"
                          placeholder="Number"
                        />
                      </div>

                      <div className="flex gap-4 pt-4">
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input
                            type="radio"
                            checked={formData.atmosphere === 'Oxidation'}
                            onChange={() => setFormData({ ...formData, atmosphere: 'Oxidation' })}
                            className="w-5 h-5"
                          />
                          <span className="text-base">Oxidation</span>
                        </label>
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input
                            type="radio"
                            checked={formData.atmosphere === 'Reduction'}
                            onChange={() => setFormData({ ...formData, atmosphere: 'Reduction' })}
                            className="w-5 h-5"
                          />
                          <span className="text-base">Reduction</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <div className="rounded-lg p-6 mb-6" style={{ backgroundColor: '#F5F5F5' }}>
                    <h3 className="font-mono text-base text-[#0D382C] mb-4 pb-2 border-b border-[#D9D9D9]">
                      Glaze details
                    </h3>
                    
                    {formData.layers.map((layer, index) => (
                      <div key={index} className="mb-4 rounded-lg p-4" style={{ backgroundColor: '#FFFFFF' }}>
                        <div className="flex justify-between items-center mb-3">
                          <span className="text-sm font-medium text-[#1E1E1E]">
                            {index === 0 ? 'Base layer' : `Layer ${index + 1}`}
                          </span>
                          {index > 0 && (
                            <button
                              onClick={() => removeLayer(index)}
                              className="text-[#C00F0C] text-sm underline"
                            >
                              Remove
                            </button>
                          )}
                        </div>
                        
                        <div className="grid grid-cols-2 gap-4 mb-4">
                          <div>
                            <label className="block text-base text-[#1E1E1E] mb-2">Brand</label>
                            <input
                              list="brand-options"
                              value={layer.brand}
                              onChange={(e) => updateLayer(index, 'brand', e.target.value)}
                              className="w-full px-4 py-3 border border-[#D9D9D9] rounded-lg bg-white"
                              placeholder="Select or type..."
                            />
                            <datalist id="brand-options">
                              {brandOptions.map(opt => <option key={opt} value={opt} />)}
                            </datalist>
                          </div>

                          <div>
                            <label className="block text-base text-[#1E1E1E] mb-2">Glaze name</label>
                            <input
                              list="glaze-options"
                              value={layer.glaze}
                              onChange={(e) => updateLayer(index, 'glaze', e.target.value)}
                              className="w-full px-4 py-3 border border-[#D9D9D9] rounded-lg bg-white"
                              placeholder="Select or type..."
                            />
                            <datalist id="glaze-options">
                              {glazeOptions.map(opt => <option key={opt} value={opt} />)}
                            </datalist>
                          </div>
                        </div>

                        <div className="flex items-center gap-6">
                          <div className="flex items-center gap-2">
                            <label className="text-base text-[#1E1E1E]">Coats:</label>
                            <input
                              type="number"
                              value={layer.coats || ''}
                              onChange={(e) => updateLayer(index, 'coats', e.target.value)}
                              className="w-20 px-3 py-2 border border-[#D9D9D9] rounded-lg"
                              placeholder="0"
                              min="0"
                            />
                          </div>
                          <div className="flex gap-4">
                            <label className="flex items-center gap-2 cursor-pointer">
                              <input
                                type="radio"
                                checked={layer.application === 'Dipped'}
                                onChange={() => updateLayer(index, 'application', 'Dipped')}
                                className="w-5 h-5"
                              />
                              <span className="text-base">Dipped</span>
                            </label>
                            <label className="flex items-center gap-2 cursor-pointer">
                              <input
                                type="radio"
                                checked={layer.application === 'Brushed'}
                                onChange={() => updateLayer(index, 'application', 'Brushed')}
                                className="w-5 h-5"
                              />
                              <span className="text-base">Brushed</span>
                            </label>
                          </div>
                        </div>
                      </div>
                    ))}

                    <button
                      onClick={addLayer}
                      className="flex items-center gap-1 text-sm text-[#757575] underline mt-4"
                    >
                      <Plus size={20} />
                      Add new layer
                    </button>
                  </div>

                  <div className="mb-6">
                    <label className="block text-base text-[#1E1E1E] mb-2">Result</label>
                    <div className="flex gap-4">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="radio"
                          checked={formData.result === 'Good'}
                          onChange={() => setFormData({ ...formData, result: 'Good' })}
                          className="w-5 h-5"
                        />
                        <span className="text-base">Good</span>
                      </label>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="radio"
                          checked={formData.result === 'Bad'}
                          onChange={() => setFormData({ ...formData, result: 'Bad' })}
                          className="w-5 h-5"
                        />
                        <span className="text-base">Bad</span>
                      </label>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-base text-[#1E1E1E] mb-2">Notes</label>
                    <textarea
                      value={formData.notes}
                      onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                      className="w-full px-4 py-3 border border-[#D9D9D9] rounded-lg text-base h-24 resize-none"
                      placeholder="Add any notes..."
                    />
                  </div>

                  <div className="border-t border-[#D9D9D9] pt-6" />

                  <div className="flex justify-between items-center">
                    {editingPiece ? (
                      <button
                        onClick={handleDelete}
                        className="flex items-center gap-1 text-[#C00F0C] text-sm underline"
                      >
                        <Trash2 size={20} />
                        Delete
                      </button>
                    ) : (
                      <div />
                    )}
                    <div className="flex gap-2">
                      <button
                        onClick={closeSidebar}
                        className="px-6 py-2 font-mono font-medium"
                        style={{ border: '1px solid #757575', borderRadius: '100px' }}
                      >
                        Cancel
                      </button>
                      <button
                        onClick={handleSave}
                        className="px-6 py-2 font-mono font-medium"
                        style={{ backgroundColor: '#1E654B', color: '#FFFFFF', borderRadius: '100px' }}
                      >
                        Save entry
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </>
          )}

          {fullImageView && imagePreview && (
            <div
              className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-8"
              style={{ zIndex: 9999 }}
              onClick={() => setFullImageView(false)}
            >
              <img
                src={imagePreview}
                alt="Full view"
                className="max-w-full max-h-full object-contain"
              />
              <button
                onClick={() => setFullImageView(false)}
                className="absolute top-4 right-4 text-white"
              >
                <X size={32} />
              </button>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<CeramicsInventory />, document.getElementById('root'));
  </script>
</body>
</html>